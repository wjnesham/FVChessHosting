<head>
	<title>Host FV Chess (Discord)</title>

	<script type="application/javascript">

		function createMessages(tournamentID) {

			var form = document.getElementById('createForm');
			var generated = document.getElementById('generated')

			var day = dayOfWeekAsString(getTournamentDate().getDay())

			var chessLink = "https://lichess.org/tournament/" + tournamentID;
			document.getElementById('token').value = chessLink;

			var password = document.getElementById('pass').value

			generated.textContent = 'Generated ' + day + ' Messages. Enjoy! ^-^'

			document.getElementById('dow1').textContent = (day)
			document.getElementById('dow2').textContent = (day)
			document.getElementById('dow3').textContent = (day)
			document.getElementById('daycmd').textContent = (day)

			document.getElementById('link1').textContent = (chessLink)
			document.getElementById('link2').textContent = (chessLink)
			document.getElementById('link3').textContent = (chessLink)

			document.getElementById('pass1').textContent = (password)
			document.getElementById('pass2').textContent = (password)
			document.getElementById('pass3').textContent = (password)

		}

		function dayOfWeekAsString(dayIndex) {
			return ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][dayIndex] || 'LaughAtFlutterwolfDay';
		}

		function loadSignIn() {
			const url = "https://lichess.org/account/oauth/token/create?scopes[]=challenge:write&scopes[]=puzzle:read&scopes[]=study:write&scopes[]=tournament:write&scopes[]=team:write&scopes[]=msg:write&description=FV+admin+chess+token";

			var frm = document.getElementById('createForm');
			var tokenUrlButton = document.getElementById('tokenLink')
			tokenUrlButton.href = url;
		}

		function getTournamentDate(params) {
			const cd = new Date();
			var utcDate1 = new Date(cd.toUTCString());

			const est8pm = 13 + (cd.getTimezoneOffset() / 60);
			const est10am = 3 + (cd.getTimezoneOffset() / 60);

			switch (utcDate1.getDay()) {
				case 2:
					// Tuesday
					utcDate1.setHours(est8pm, 0, 0, 0)
					break;
				case 4:
					// Thursday
					utcDate1.setHours(est8pm, 0, 0, 0)
					break;
				case 6:
					// Sat
					utcDate1.setHours(est10am, 30, 0, 0)
					break;

				default:
					// assume weekday
					utcDate1.setHours(est8pm, 0, 0, 0)
					break;
			}

			return utcDate1;
		}

		function getPostBody() {
			var clockTime = document.getElementById('minutes').value

			var increment = document.getElementById('seconds').value

			var password = document.getElementById('pass').value

			var description = document.getElementById('description').value

			// Set defaults if no values were supplied.
			if (clockTime == null || typeof (clockTime) == 'string' || clockTime < 1) {
				clockTime = 5;
				document.getElementById('minutes').value = clockTime;
			}
			if (increment == null || typeof (increment) == 'string' || increment < 1) {
				increment = 5;
				document.getElementById('seconds').value = increment;
			}
			if (password == null || password == "") {
				password = "Pawshop";
				document.getElementById('pass').value = password;
			}
			if (description == null || description == "") {
				description = "Fur Brawls :3";
				document.getElementById('description').value = description;
			}

			var details = {
				'name': "Furry Valley Tournament",
				'clockTime': clockTime,
				'clockIncrement': increment,
				'minutes': 60,
				'waitMinutes': 60,
				'startDate': getTournamentDate().getTime(),
				'berserkable': false,
				'description': description,
				'password': password
			};
			var formBody = [];
			for (var property in details) {
				var encodedKey = encodeURIComponent(property);
				var encodedValue = encodeURIComponent(details[property]);
				formBody.push(encodedKey + "=" + encodedValue);
			}
			return formBody.join("&");
		}

		function doSubmit() {
			const url = "https://lichess.org/api/tournament";

			/// TODO: Replace the line below to cache your token //////////////////////////////////////////////////////////////////////////////
			const personalToken = document.getElementById('token').value; // const personalToken = [your_token];
			/// TODO: replace the line above with, "const personalToken = [your_token];" //////////////////////////////////////////////////////


			const formBody = getPostBody();

			fetch(url, {
				method: "POST",

				headers: {
					'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
					'Authorization': 'Bearer ' + personalToken
				},
				body: formBody
			})
				.then(res => {
					res.json().then(data => {
						if (data.id == null) {
							var errorMsg = '';
							if (typeof (data['error']) == 'string') {
								errorMsg = data['error'] + "\nAdd the Lichess Token and try again.";
							} else {
								for (const key in data['error']) {
									if (Object.hasOwnProperty.call(data['error'], key)) {
										errorMsg += (key + ': ' + data['error'][key] + '\n')
									}
								}
							}

							alert("Error creating tournament! Error = " + errorMsg);
							return;
						} else {
							// Hide submit button
							document.getElementById('submitButton').hidden = true;
						}


						createMessages(data.id)
					})
				});

		}


	</script>
	<style>
		div {
			border: 15px solid mediumslateblue;
			background-color: turquoise;
			text-align: center;
		}

		padding {
			padding-left: 75px;
			background-color: lavender;
		}

		h1 {
			color: purple;
			text-shadow: 20px black;
			font: italic bold 32px Georgia, serif;
		}

		h2 {
			border: 4px solid mediumslateblue;
			text-align: center;
			color: aquamarine;
			padding-top: 10px;
			padding-bottom: 10px;
		}

		h3 {
			padding-left: 5px;
			padding-top: 50px;
			padding-bottom: 5px;
		}

		h4 {
			color: yellow;
			padding-left: 60px;
			padding-top: 15px;
		}

		form {
			padding-top: 15px;
			padding-bottom: 15px;
			color: purple;
		}

		a {
			color: aqua;
			text-decoration: underline;
		}

		body {
			background-color: black;
			color: lavender;
			padding-left: 15px;
			padding-right: 15px;
			font: arial, serif;
		}

		highlight {
			padding-left: 8px;
			padding-right: 8px;

			background-color: rgb(43, 16, 59);
			word-wrap: normal;
		}
	</style>
</head>

<body onload="loadSignIn()">
	<br>
	<div>
		<h1>Host Furry Valley Chess Tournament</h1>
	</div>
	<br>
	- step 1: Join chess VC
	<br>
	- Step 2: <a href="https://lichess.org/tournament/new">Create chess tournament</a>
	<br>
	- Step 3: Paste tournament URL in the form below
	<br>


	<h3>> At 1 hour till: <a href="https://twitter.com/home">Twitter</a> and <a
			href="https://discord.com/channels/282819774621417483/772261264062939146">#Chess
			Announcements</a></h3>
	<highlight> @Chess<br>
		Heyo Chess Floofs! In 60 minutes is the <u id="dow1"></u> Night Chess tournament!
		We will be in the chess
		VC if you want to talk with other Floofs! Hope to see you there and good luck!
		<br>
		Link: <u id="link1"></u>
		<br>
		Password: <u id="pass1"></u>
	</highlight>
	<br>
	<br>
	<h3>> At 30 minutes till: <a href="https://discord.com/channels/282819774621417483/679302617289064468">#Admin Event
			Hosting</a></h3>
	<highlight>!lfg chess casual tournament <u id="daycmd"></u> night 8pm</highlight>
	<br>
	** Enter above command and react to one or two blocks. (Message people in those blocks) **
	<br>
	<br>
	<highlight>`Hey floof! In 30 minutes we are going to have the <u id="dow2"></u> Chess Tournament of Furry Valley! If
		you want to join us, use the link and password given below! Also, you can join the VC to talk to others while
		playing
		some chess. Hope to see you there!
		<br>
		Link: <u id="link2"></u>
		<br>
		Password: <u id="pass2"></u>
		`
	</highlight>
	<br>
	<br>
	<h3>> At 5-10 minutes till: <a href="https://discord.com/channels/282819774621417483/772261264062939146">#Chess
			Announcements</a></h3>
	<highlight> @Chess<br>
		Heyo Chess Floofs! In 5 minutes is the <u id="dow3"></u> Night Chess tournament!
		We will be in the chess VC if you want to talk with other Floofs! Hope to see you there and Good luck!
		<br>
		Link: <u id="link3"></u>
		<br>
		Password: <u id="pass3"></u>
	</highlight>
	<br>
	<br>


	<br>
	<a id="tokenLink" href="" target="_blank" rel="noopener noreferrer">Generate Lichess Token</a>
	<br>
	<h4 id="generated">Fill this out and click the button to generate messages ^-^</h4>

	<div>
		<form id="createForm">
			<label for="tournament-url">Tournament URL:</label>
			<input id="tournament-url" type="text" value="Leave Blank" name="URL">
			<br>
			<label for="pass">Password:
				&emsp;&emsp;&emsp;</label>
			<input id="pass" type="text" value="Pawshop" name="pass">
			<br>
			<br>
			<label for="token">*Lichess Token:
				&emsp;</label>
			<input id="token" type="password" name="token">
			<br>
			<br>
			<strong>- Time Control -</strong>
			<br>
			<label for="minutes">Minutes:
				&emsp;&emsp;&emsp;</label>
			<input id="minutes" type="number" value="5" name="minutes">
			<br>
			<label for="seconds">Seconds:
				&emsp;&emsp;&emsp;</label>
			<input id="seconds" type="number" value="5" name="seconds">
			<br>
			<br>
			<strong>- Tournament message -</strong>
			<br>
			<label for="description">Description:
				&emsp;&emsp;</label>
			<input id="description" type="text" value="Fur Brawls :3" name="description">
			<br>
			<br>
			<input id="submitButton" type="button" onclick="doSubmit()" value="Create Messages">
		</form>
	</div>



	<br><br><br>
	<a href="https://discord.com/channels/282819774621417483/772261264062939146">#Chess Announcements</a>
	<br>
	<br>

	<a href="https://discord.com/channels/282819774621417483/679302617289064468">#Admin Event Hosting</a>
	<br>
	<br>
	<a href="https://twitter.com/home">Twitter</a>
	<br><br><br>
</body>